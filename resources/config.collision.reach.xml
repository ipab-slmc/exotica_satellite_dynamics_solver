<?xml version="1.0" ?>
<PlannerDemoConfig>
    <FeasibilityDrivenDDPSolver Name="FDDP">
        <Debug>1</Debug>
        <MaxIterations>150</MaxIterations>
        <ClampControlsInForwardPass>1</ClampControlsInForwardPass>
        <GradientTolerance>1e-5</GradientTolerance>
    </FeasibilityDrivenDDPSolver>

    <!-- Does not work... -->
    <!-- <ControlLimitedFeasibilityDrivenDDPSolver Name="FDDP">
        <Debug>1</Debug>
        <MaxIterations>150</MaxIterations>
        <BoxQPUseCholeskyFactorization>0</BoxQPUseCholeskyFactorization>
        <GradientTolerance>1e-5</GradientTolerance>
        <RegularizationRate>0.1</RegularizationRate>
    </ControlLimitedFeasibilityDrivenDDPSolver> -->

    <DynamicTimeIndexedShootingProblem Name="satellite">
        <!-- Turning second order off also causes Cholesky to trip up. For real. -->
        <DerivativeOrder>2</DerivativeOrder>

        <!-- Huber for the thrusters -->
        <!-- <HuberRate>0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1     0   0   0  0</HuberRate>     -->
        <!-- <HuberRate>
            0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1
            0.1 0.1 0.1 0.1 0.1 0.1 0.1
        </HuberRate> -->
        <HuberRate>
            1 1 1 1 1 1 1 1 1 1 1 1 1
            1 1 1 1 1 1 1
        </HuberRate>
        <L1Rate>10</L1Rate>
        <L1IncreaseRate>1.01</L1IncreaseRate>
        <ControlCostWeight>1</ControlCostWeight>

        <LossType>L2</LossType>
        <!-- <R_rate>1e-3 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3 1e-3   1e-1 1e-1 1e-1 1e-1</R_rate> -->
        <R_rate>1e-3</R_rate>
        <!-- <R>
            0 0 0 0 0 0 0 0 0 0 0 0 0
            1 1 1 1 1 1 1
        </R> -->

        <PlanningScene>
            <Scene>
                <!-- <JointGroup>base_with_arm</JointGroup>
                <URDF>{exotica_satellite_dynamics_solver}/resources/robots/satellite/satellite.urdf</URDF>
                <SRDF>{exotica_satellite_dynamics_solver}/resources/robots/satellite/satellite.srdf</SRDF>
                <SetRobotDescriptionRosParams>1</SetRobotDescriptionRosParams>
                <DynamicsSolver>
                    <SatelliteDynamicsSolver Name="dsolver">
                        <ControlLimitsLow>0 0 0 0 0 0 0 0 0 0    -5 -5 -5 -5</ControlLimitsLow>
                        <ControlLimitsHigh>440 440 440 440 440 440 440 440 440 440  5 5 5 5</ControlLimitsHigh>
                        <Thrusters>
                            <ForceInput LinkName="base_to_thruster_bot" ForceDirection="0 0 -1"/>
                            <ForceInput LinkName="base_to_thruster_bot_1" ForceDirection="0 1 0"/>
                            <ForceInput LinkName="base_to_thruster_bot_2" ForceDirection="-1 0 0"/>
                            <ForceInput LinkName="base_to_thruster_bot_3" ForceDirection="0 -1 0"/>
                            <ForceInput LinkName="base_to_thruster_bot_4" ForceDirection="1 0 0"/>
                            
                            <ForceInput LinkName="base_to_thruster_top" ForceDirection="0 0 1"/>
                            <ForceInput LinkName="base_to_thruster_top_1" ForceDirection="0 1 0"/>
                            <ForceInput LinkName="base_to_thruster_top_2" ForceDirection="-1 0 0"/>
                            <ForceInput LinkName="base_to_thruster_top_3" ForceDirection="0 -1 0"/>
                            <ForceInput LinkName="base_to_thruster_top_4" ForceDirection="1 0 0"/>
                        </Thrusters>
                        <dt>1</dt>
                    </SatelliteDynamicsSolver>
                </DynamicsSolver> -->

                <JointGroup>base_with_arm</JointGroup>
                <URDF>{ssl_1300_orbital_manipulator_description}/urdf/ssl_1300_orbital_manipulator.urdf</URDF>
                <SRDF>{ssl_1300_orbital_manipulator_description}/srdf/ssl_1300_orbital_manipulator.srdf</SRDF>
                
                <SetRobotDescriptionRosParams>1</SetRobotDescriptionRosParams>
                <DynamicsSolver>
                    <SatelliteDynamicsSolver Name="dsolver">
                        <!-- True limits for arm: -4903.32 -5883.99 -2549.73 -2549.73 -720.2 -720.2 -255.76 -->
                        <ControlLimitsLow>
                            0 0 0 0 0 0 0 0 0 0 0 0 0
                            -4903.32 -5883.99 -2549.73 -2549.73 -720.2 -720.2 -255.76
                        </ControlLimitsLow>
                        <ControlLimitsHigh>
                            450 20 20 20 20 20 20 20 20 20 20 20 20
                            4903.32 5883.99 2549.73 2549.73 720.2 720.2 255.76
                        </ControlLimitsHigh>
                        <Thrusters>
                            <ForceInput LinkName="thruster_main_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster1_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster2_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster3_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster4_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster5_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster6_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster7_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster8_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster9_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster10_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster11_joint" ForceDirection="1 0 0"/>
                            <ForceInput LinkName="thruster12_joint" ForceDirection="1 0 0"/>
                        </Thrusters>
                        <dt>1</dt>
                    </SatelliteDynamicsSolver>
                </DynamicsSolver>

                <Links>
                    <Link Name="Obstacle0" Transform="5   5   5"/>
                    <Link Name="Obstacle1" Transform="6   4   5"/>
                    <Link Name="Obstacle2" Transform="7   3   5"/>
                    <Link Name="Obstacle3" Transform="4   6   5"/>
                    <Link Name="Obstacle4" Transform="3   7   5"/>
                </Links>
            </Scene>
        </PlanningScene>

        <!-- end-effector task maps -->
        <Maps>
            <!-- <SphereCollision Name="collision">
                <Debug>1</Debug>
                <Precision>0.1</Precision>
                <ReferenceFrame>exotica/world_frame</ReferenceFrame>
                <EndEffector>
                    <Frame Link="base_link" Radius="1.3" Group="Satellite" />

                    <Frame Link="sia50d_tool0" Radius="0.3" Group="Satellite" />
                    <Frame Link="sia50d_link_r" Radius="0.3" Group="Satellite" />
                    <Frame Link="sia50d_link_l" Radius="0.3" Group="Satellite" />

                    <Frame Link="Obstacle0" Radius="1" Group="Obstacle0" />
                    <Frame Link="Obstacle1" Radius="1" Group="Obstacle1" />
                    <Frame Link="Obstacle2" Radius="1" Group="Obstacle2" />
                    <Frame Link="Obstacle3" Radius="1" Group="Obstacle3" />
                    <Frame Link="Obstacle4" Radius="1" Group="Obstacle4" />
                </EndEffector>
            </SphereCollision> -->


            <EffPosition Name="Position">
                <EndEffector>
                    <!-- <Frame Link="arm_end_eff" LinkOffset="0 0 0  1 0 0 0"/> -->
                    <Frame Link="sia50d_tool0"/>
                </EndEffector>
            </EffPosition>
            <JointLimit Name="JointLimit"/>
        </Maps>

        <Cost>
            <Task Task="Position" Goal="10 10 10" Rho="
            0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
            0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
            0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 100.0
        "/>
            <Task Task="JointLimit" Rho="1e-6"/>
            <!-- <Task Task="collision" Rho="1e-2"/> -->
        </Cost>

        <T>300</T>
        <tau>1</tau>

        <Q_rate>0</Q_rate>
        <Q>
            0 0 0 0 0 0
            0 0 0 0 0 0 0
            1 1 1 1 1 1
            1 1 1 1 1 1 1
        </Q>

        <Qf_rate>100</Qf_rate>
        <Qf>
            0 0 0 0 0 0
            0 0 0 0 0 0 0
            1 1 1 1 1 1
            1 1 1 1 1 1 1
        </Qf>

        <!-- <StartState> 0 0 0     0 0 0 1     0 0 0    0 0 0      0   0    0    0      0 0 0 0</StartState> -->
        <!-- <GoalState>  0 0 5     0 0 0 1     0 0 0    0 0 0      1.5   1.5  1.5  1.5      0 0 0 0</GoalState> -->

        <!-- <StartState> 2 2 2        0 0 0 1       0     0    0     0          0 0 0  0 0 0  0 0 0 0</StartState>
        <GoalState>  0 0 0        0 0 0 1       0     0    0     0          0 0 0  0 0 0  0 0 0 0</GoalState> -->

        <StartState> 0 0 0        0 0 0 1       0     0    0     0          0 0 0  0 0 0  0 0 0 0 0 0 0 0 0 0</StartState>
        <GoalState>  0 0 0        0 0 0 1       0     0    0     0          0 0 0  0 0 0  0 0 0 0 0 0 0 0 0 0</GoalState>
    </DynamicTimeIndexedShootingProblem>
</PlannerDemoConfig>
